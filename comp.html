<!DOCTYPE html>
<html>
<head>
  <title>Kompass und Fensterausrichtung</title>
</head>
<body>

<h1>Kompass und Fensterausrichtung</h1>
<button id="requestPermission">Berechtigung anfordern</button>
<p>Absolute Ausrichtung: <span id="absoluteOrientation">Lädt...</span> Grad</p>
<p>Fensterausrichtung: <span id="windowOrientation">Lädt...</span> Grad</p>

<script>
  let correctedOrientation = null;

  async function requestPermission() {
    // DeviceOrientationEvent.requestPermission ist speziell für iOS 13+
    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
      const permission = await DeviceOrientationEvent.requestPermission();
      if (permission === 'granted') {
        // Berechtigung erteilt, Event-Listener hinzufügen
        addOrientationListener();
      } else {
        alert('Berechtigung nicht erteilt');
      }
    } else {
      // Nicht iOS 13+, fügen Sie den Event-Listener direkt hinzu
      addOrientationListener();
    }
  }

  function addOrientationListener() {
    if ('DeviceOrientationEvent' in window) {
      window.addEventListener('deviceorientationabsolute', function(event) {
        let alpha = event.alpha;
        let windowAngle = window.orientation || 0;
        correctedOrientation = (alpha - windowAngle + 360) % 360;
        updateDisplay();
      }, true);
    } else {
      document.getElementById('absoluteOrientation').innerText = 'Ihr Gerät unterstützt diese Funktion nicht.';
    }
  }

  function updateDisplay() {
    document.getElementById('windowOrientation').innerText = window.orientation || 0;
    if (correctedOrientation !== null) {
      document.getElementById('absoluteOrientation').innerText = correctedOrientation.toFixed(2);
    }
  }

  // Event-Listener für Änderungen der Fensterausrichtung hinzufügen
  window.addEventListener("orientationchange", function() {
    updateDisplay();
  }, false);

  // Anfangswerte setzen
  updateDisplay();

  // Button für Berechtigungsanfrage
  document.getElementById("requestPermission").addEventListener("click", requestPermission);

</script>

</body>
</html>
