<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity id="myEntity" absolute-orientation>
        <a-box position="0 0 -6" color="red"></a-box>
      </a-entity>
      <a-box position="0 0 -6" color="blue"></a-box>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      AFRAME.registerComponent('absolute-orientation', {
        init: function () {
          // Anfrage für die Berechtigung zur Geräteausrichtung
          if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
              .then(response => {
                if (response == 'granted') {
                  // Berechtigung erteilt, Event-Listener hinzufügen
                  window.addEventListener('deviceorientationabsolute', this.onDeviceOrientationAbsolute.bind(this), true);
                } else {
                  // Berechtigung verweigert
                  console.log('Permission denied.');
                }
              })
              .catch(console.error);
          } else {
            // Für Browser, die keine Berechtigungsanforderung erfordern
            window.addEventListener('deviceorientationabsolute', this.onDeviceOrientationAbsolute.bind(this), true);
          }
        },
        // Callback-Funktion für das 'deviceorientationabsolute' Event
        onDeviceOrientationAbsolute: function(event) {
          // Alpha-Wert ist die Ausrichtung um die Z-Achse und entspricht der magnetischen Nordausrichtung
          let alpha = event.alpha;

          // Setzen der Rotation der A-Frame-Entität
          this.el.setAttribute('rotation', `0 ${alpha} 0`);

          // Event-Listener entfernen, da wir nur eine einmalige Ausrichtung wollen
          window.removeEventListener('deviceorientationabsolute', this.onDeviceOrientationAbsolute.bind(this));
        }
      });
    </script>
  </body>
</html>
