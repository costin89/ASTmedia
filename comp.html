<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity id="myEntity" geometry="primitive: box" absolute-orientation>
        <a-box position="0 0 -6" color="red"></a-box>
      </a-entity>
      <a-box position="0 0 -6" color="blau"></a-box>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      AFRAME.registerComponent('absolute-orientation', {
        init: function () {
          // Anfrage für die Berechtigung zur Geräteausrichtung
          if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
              .then(response => {
                if (response === 'granted') {
                  // Berechtigung erteilt, Event-Listener hinzufügen
                  window.addEventListener('deviceorientation', this.onDeviceOrientation.bind(this), true);
                } else {
                  // Berechtigung verweigert
                  console.log('Permission denied.');
                }
              })
              .catch(console.error);
          } else {
            // Für Browser, die keine Berechtigungsanforderung erfordern
            window.addEventListener('deviceorientation', this.onDeviceOrientation.bind(this), true);
          }
        },
        // Callback-Funktion für das 'deviceorientation' Event
        onDeviceOrientation: function(event) {
          let alpha;

          if (event.webkitCompassHeading) {
            // Safari auf iOS
            alpha = event.webkitCompassHeading;
          } else if (event.alpha !== null) {
            // Andere Browser
            if (event.absolute) {
              alpha = event.alpha;
            } else {
              // Fallback, falls die absolute Ausrichtung nicht verfügbar ist
              alpha = event.alpha;
            }
          }

          if (alpha !== undefined) {
            // Setzen der Rotation der A-Frame-Entität
            this.el.setAttribute('rotation', `0 ${alpha} 0`);

            // Event-Listener entfernen, da wir nur eine einmalige Ausrichtung wollen
            window.removeEventListener('deviceorientation', this.onDeviceOrientation.bind(this));
          }
        }
      });
    </script>
  </body>
</html>
