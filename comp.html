<!DOCTYPE html>
<html>
<head>
  <title>Himmelsrichtungen</title>
</head>
<body>

  <h1>Himmelsrichtungen</h1>

  <label id="absoluteDirection">Absolute Richtung: Unbekannt</label><br>
  <label id="relativeDirection">Relative Richtung: Unbekannt</label>

  <script>
    // Prüfen, ob die APIs unterstützt werden
    if ("geolocation" in navigator && 'DeviceOrientationEvent' in window) {
      
      // Berechtigungsanfrage für Geolocation
      navigator.permissions.query({name:'geolocation'}).then(function(permissionStatus) {
        if (permissionStatus.state === 'granted') {
          // Erlaubnis wurde bereits erteilt
          startTracking();
        } else if (permissionStatus.state === 'prompt') {
          // Fragen Sie nach Erlaubnis
          navigator.geolocation.getCurrentPosition(function() {
            startTracking();
          });
        }
      });

      // Starte die Ortung und die Device Orientation Erfassung
      function startTracking() {

        let alphaOffset = 0; // Zur Anpassung des Kompasswinkels (Alpha)
        
        // Geolocation
        navigator.geolocation.watchPosition(function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const absoluteDirection = `Latitude: ${lat}, Longitude: ${lon}`;
          document.getElementById("absoluteDirection").textContent = "Absolute Richtung: " + absoluteDirection;
        });

        // Device Orientation
        window.addEventListener('deviceorientation', function(event) {
          let alpha = event.alpha - alphaOffset;
          if (alpha < 0) alpha += 360;
          if (alpha > 360) alpha -= 360;
          document.getElementById("relativeDirection").textContent = "Relative Richtung: " + alpha.toFixed(2) + "°";
        });

        // iOS spezifische Einstellungen
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
            .then(response => {
              if (response === 'granted') {
                // Erlaubnis für Device Orientation auf iOS
                window.addEventListener('deviceorientation', (event) => {
                  // Verarbeiten der Device Orientation Daten
                });
              }
            })
            .catch(console.error);
        }
      }
      
    } else {
      // APIs nicht unterstützt
      alert("Ihr Browser unterstützt nicht die benötigten APIs für dieses Beispiel.");
    }
  </script>

</body>
</html>
