<!DOCTYPE html>
<html>
<head>
  <title>Geolocation mit Heading</title>
</head>
<body>

<h1>Mein Standort und Ziel</h1>
<button onclick="getLocation()">Standort abrufen</button>
<p id="demo"></p>

Latitude Ziel: <input type="text" id="latTarget"><br>
Longitude Ziel: <input type="text" id="lonTarget"><br>
<button onclick="calculateHeading()">Heading berechnen</button>
<p id="headingResult"></p>
<p id="distanceResult"></p>
  
<script>
var lat1, lon1;

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else {
    document.getElementById("demo").innerHTML = "Geolocation wird von diesem Browser nicht unterstützt.";
  }
}

function showPosition(position) {
  lat1 = position.coords.latitude;
  lon1 = position.coords.longitude;
  document.getElementById("demo").innerHTML = "Breitengrad: " + lat1 + "<br>Längengrad: " + lon1;
}

function toRadians(degrees) {
  return degrees * Math.PI / 180;
}

function calculateHeading() {
  var lat2 = parseFloat(document.getElementById("latTarget").value);
  var lon2 = parseFloat(document.getElementById("lonTarget").value);

  var dLon = toRadians(lon2 - lon1);

  var x = Math.sin(dLon) * Math.cos(toRadians(lat2));
  var y = Math.cos(toRadians(lat1)) * Math.sin(toRadians(lat2)) -
            Math.sin(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.cos(dLon);

  var heading = Math.atan2(x, y);
  heading = heading * 180 / Math.PI;
  heading = (heading + 360) % 360; // Um negative Werte zu vermeiden
  document.getElementById("headingResult").innerHTML = "Das Heading beträgt: " + heading + " Grad";
  
  // Haversine Formel für die Distanz
  var R = 6371; // Radius der Erde in km
  var dLat = toRadians(lat2 - lat1);
  var dLon = toRadians(lon2 - lon1);
  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  var distance = R * c;
  document.getElementById("distanceResult").innerHTML = "Die Distanz beträgt: " + distance.toFixed(2) + " km";
}
</script>

</body>
</html>
