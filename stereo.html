<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Device Orientation and Three.js</title>
    <script src="https://threejs.org/build/three.js"></script>
  </head>
  <body>

    <button id="requestPermissionButton">Enable Device Orientation</button>

    <script>
      // Device Orientation Handler Klasse
      class DeviceOrientationHandler {
        constructor() {
          this.alpha = 0;
          this.beta = 0;
          this.gamma = 0;
          this.permissionGranted = false;
        }

        async requestPermission() {
          if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
            try {
              const permission = await DeviceOrientationEvent.requestPermission();
              if (permission === 'granted') {
                this.permissionGranted = true;
                window.addEventListener('deviceorientation', this.handleOrientation.bind(this));
              }
            } catch (error) {
              console.error('Permission denied:', error);
            }
          } else {
            this.permissionGranted = true;
            window.addEventListener('deviceorientation', this.handleOrientation.bind(this));
          }
        }

        handleOrientation(event) {
          this.alpha = event.alpha;
          this.beta = event.beta;
          this.gamma = event.gamma;
        }
      }

      const deviceOrientationHandler = new DeviceOrientationHandler();
      document.getElementById('requestPermissionButton').addEventListener('click', () => deviceOrientationHandler.requestPermission());

      // Three.js Code
      var scene, camera, renderer;

      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 5;

      renderer = new THREE.WebGLRenderer({ alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      var geometry = new THREE.BoxGeometry();
      var material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
      var cube = new THREE.Mesh(geometry, material);
      scene.add(cube);

      function animate() {
        requestAnimationFrame(animate);

        if (deviceOrientationHandler.permissionGranted) {
          camera.rotation.x = THREE.Math.degToRad(deviceOrientationHandler.beta);
          camera.rotation.y = THREE.Math.degToRad(deviceOrientationHandler.alpha);
        }

        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;

        renderer.render(scene, camera);
      }

      animate();
    </script>

  </body>
</html>
